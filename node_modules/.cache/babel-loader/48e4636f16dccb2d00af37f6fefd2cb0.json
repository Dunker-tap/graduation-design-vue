{"remainingRequest":"E:\\IDEA\\project\\ant-design-vue-jeecg\\node_modules\\babel-loader\\lib\\index.js!E:\\IDEA\\project\\ant-design-vue-jeecg\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js??ref--13-0!E:\\IDEA\\project\\ant-design-vue-jeecg\\src\\views\\user\\third\\JeecgThirdLoginMixin.js","dependencies":[{"path":"E:\\IDEA\\project\\ant-design-vue-jeecg\\src\\views\\user\\third\\JeecgThirdLoginMixin.js","mtime":1715586076350},{"path":"E:\\IDEA\\project\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1621061384845},{"path":"E:\\IDEA\\project\\ant-design-vue-jeecg\\node_modules\\babel-loader\\lib\\index.js","mtime":1621061377995},{"path":"E:\\IDEA\\project\\ant-design-vue-jeecg\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js","mtime":1617935819779}],"contextDependencies":[],"result":["function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n/**\r\n *第三方登录\r\n */\nimport { mapActions } from 'vuex';\nimport { postAction } from '@api/manage';\nimport { timeFix } from '@/utils/util';\nexport var JeecgThirdLoginMixin = {\n  data: function data() {\n    return {\n      //第三方登录相关信息\n      thirdLoginInfo: '',\n      thirdPasswordShow: false,\n      thirdLoginPassword: '',\n      thirdLoginUser: '',\n      thirdConfirmShow: false,\n      thirdCreateUserLoding: false,\n      thirdLoginState: false,\n      //绑定手机号弹窗\n      bindingPhoneModal: false,\n      thirdPhone: '',\n      thirdCaptcha: '',\n      //获取验证码按钮30s之内是否可点击\n      thirdState: {\n        time: 30,\n        smsSendBtn: false\n      },\n      //第三方用户UUID\n      thirdUserUuid: '',\n      thirdType: '',\n      url: {\n        bindingThirdPhone: '/sys/thirdLogin/bindingThirdPhone'\n      }\n    };\n  },\n  created: function created() {},\n  methods: _objectSpread({}, mapActions(['ThirdLogin']), {\n    //第三方登录\n    onThirdLogin: function onThirdLogin(source) {\n      /*if (source === 'face_verify') {\r\n        let faceUrl = ' http://localhost:8080/'\r\n        window.open(faceUrl, `login ${source}`, 'height=500, width=500, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=n o, status=no')\r\n        return\r\n      }*/\n      if (source === 'face_verify') {\n        // this.$router.push('/faceLogin')\n        var faceRoute = this.$router.resolve({\n          path: '/faceLogin'\n        });\n        this.$message.success('url:' + faceRoute.href); // window.open(faceRoute.href, `login ${source}`, 'height=500,width=500,top=0,left=0,toolbar=no,menubar=no,scrollbars=no,resizable=no,location=no,status=no')\n        // window.open(faceRoute.href, `_blank`, 'height=500,width=500,top=0,left=0,toolbar=no,menubar=no,scrollbars=no,resizable=no,location=no,status=no')\n\n        this.$router.push({\n          path: '/faceLogin'\n        }).catch(function () {});\n        return;\n      }\n\n      var url = window._CONFIG['domianURL'] + \"/sys/thirdLogin/render/\".concat(source);\n      window.open(url, \"login \".concat(source), 'height=500, width=500, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=n o, status=no');\n      var that = this;\n      that.thirdType = source;\n      that.thirdLoginInfo = '';\n      that.thirdLoginState = false;\n\n      var receiveMessage = function receiveMessage(event) {\n        var token = event.data;\n\n        if (typeof token === 'string') {\n          //如果是字符串类型 说明是token信息\n          if (token === '登录失败') {\n            that.$message.warning(token);\n          } else if (token.includes('绑定手机号')) {\n            that.bindingPhoneModal = true;\n            var strings = token.split(',');\n            that.thirdUserUuid = strings[1];\n          } else {\n            that.doThirdLogin(token);\n          }\n        } else if (_typeof(token) === 'object') {\n          //对象类型 说明需要提示是否绑定现有账号\n          if (token['isObj'] === true) {\n            that.thirdConfirmShow = true;\n            that.thirdLoginInfo = _objectSpread({}, token);\n          }\n        } else {\n          that.$message.warning('不识别的信息传递');\n        }\n      };\n\n      window.addEventListener('message', receiveMessage, false);\n    },\n    // 根据token执行登录\n    doThirdLogin: function doThirdLogin(token) {\n      var _this = this;\n\n      if (this.thirdLoginState === false) {\n        this.thirdLoginState = true;\n        var param = {};\n        param.thirdType = this.thirdType;\n        param.token = token;\n        this.ThirdLogin(param).then(function (res) {\n          if (res.success) {\n            _this.loginSuccess();\n          } else {\n            _this.requestFailed(res);\n          }\n        });\n      }\n    },\n    // 绑定已有账号 需要输入密码\n    thirdLoginUserBind: function thirdLoginUserBind() {\n      this.thirdLoginPassword = '';\n      this.thirdLoginUser = this.thirdLoginInfo.uuid;\n      this.thirdConfirmShow = false;\n      this.thirdPasswordShow = true;\n    },\n    //创建新账号\n    thirdLoginUserCreate: function thirdLoginUserCreate() {\n      var _this2 = this;\n\n      this.thirdCreateUserLoding = true; // 账号名后面添加两位随机数\n\n      this.thirdLoginInfo['suffix'] = parseInt(Math.random() * 98 + 1); //this.thirdLoginInfo.operateCode = 123 //测试校验失败\n\n      postAction('/sys/third/user/create', this.thirdLoginInfo).then(function (res) {\n        if (res.success) {\n          var token = res.result;\n          console.log('thirdCreateNewAccount', token);\n\n          _this2.doThirdLogin(token);\n\n          _this2.thirdConfirmShow = false;\n        } else {\n          _this2.$message.warning(res.message);\n        }\n      }).finally(function () {\n        _this2.thirdCreateUserLoding = false;\n      });\n    },\n    // 核实密码\n    thirdLoginCheckPassword: function thirdLoginCheckPassword() {\n      var _this3 = this;\n\n      //this.thirdLoginInfo.operateCode = 123 //测试校验失败\n      var param = Object.assign({}, this.thirdLoginInfo, {\n        password: this.thirdLoginPassword\n      });\n      postAction('/sys/third/user/checkPassword', param).then(function (res) {\n        if (res.success) {\n          _this3.thirdLoginNoPassword();\n\n          _this3.doThirdLogin(res.result);\n        } else {\n          _this3.$message.warning(res.message);\n        }\n      });\n    },\n    // 没有密码 取消操作\n    thirdLoginNoPassword: function thirdLoginNoPassword() {\n      this.thirdPasswordShow = false;\n      this.thirdLoginPassword = '';\n      this.thirdLoginUser = '';\n    },\n    //获取第三方验证码\n    getThirdCaptcha: function getThirdCaptcha() {\n      var _this4 = this;\n\n      var that = this;\n\n      if (!this.thirdPhone) {\n        that.cmsFailed('请输入手机号');\n      } else {\n        this.thirdState.smsSendBtn = true;\n        var interval = window.setInterval(function () {\n          if (that.thirdState.time-- <= 0) {\n            that.thirdState.time = 30;\n            that.thirdState.smsSendBtn = false;\n            window.clearInterval(interval);\n          }\n        }, 1000);\n        var hide = this.$message.loading('验证码发送中..', 0);\n        var smsParams = {};\n        smsParams.mobile = this.thirdPhone;\n        smsParams.smsmode = '1';\n        postAction('/sys/sms', smsParams).then(function (res) {\n          if (!res.success) {\n            setTimeout(hide, 0);\n\n            _this4.cmsFailed(res.message);\n          }\n\n          setTimeout(hide, 500);\n        }).catch(function (err) {\n          setTimeout(hide, 1);\n          clearInterval(interval);\n          that.thirdState.time = 30;\n          that.thirdState.smsSendBtn = false;\n\n          _this4.requestFailed(err);\n        });\n      }\n    },\n    //绑定手机号点击确定按钮\n    thirdHandleOk: function thirdHandleOk() {\n      var _this5 = this;\n\n      var bingingParams = {};\n      bingingParams.mobile = this.thirdPhone;\n      bingingParams.captcha = this.thirdCaptcha;\n      bingingParams.thirdUserUuid = this.thirdUserUuid;\n      postAction(this.url.bindingThirdPhone, bingingParams).then(function (res) {\n        if (res.success) {\n          _this5.bindingPhoneModal = false;\n\n          _this5.doThirdLogin(res.result);\n        } else {\n          _this5.$message.$warning(res.message);\n        }\n      });\n    },\n    loginSuccess: function loginSuccess() {\n      // update-begin- author:sunjianlei --- date:20190812 --- for: 登录成功后不解除禁用按钮，防止多次点击\n      // this.loginBtn = false\n      // update-end- author:sunjianlei --- date:20190812 --- for: 登录成功后不解除禁用按钮，防止多次点击\n      this.$router.push({\n        path: '/dashboard/analysis'\n      }).catch(function () {\n        console.log('登录跳转首页出错,这个错误从哪里来的');\n      });\n      this.$notification.success({\n        message: '欢迎',\n        description: \"\".concat(timeFix(), \"\\uFF0C\\u6B22\\u8FCE\\u56DE\\u6765\")\n      });\n    },\n    cmsFailed: function cmsFailed(err) {\n      this.$notification['error']({\n        message: '登录失败',\n        description: err,\n        duration: 4\n      });\n    },\n    requestFailed: function requestFailed(err) {\n      this.$notification['error']({\n        message: '登录失败',\n        description: ((err.response || {}).data || {}).message || err.message || '请求出现错误，请稍后再试',\n        duration: 4\n      });\n      this.loginBtn = false;\n    }\n  })\n};",{"version":3,"sources":["E:/IDEA/project/ant-design-vue-jeecg/src/views/user/third/JeecgThirdLoginMixin.js"],"names":["mapActions","postAction","timeFix","JeecgThirdLoginMixin","data","thirdLoginInfo","thirdPasswordShow","thirdLoginPassword","thirdLoginUser","thirdConfirmShow","thirdCreateUserLoding","thirdLoginState","bindingPhoneModal","thirdPhone","thirdCaptcha","thirdState","time","smsSendBtn","thirdUserUuid","thirdType","url","bindingThirdPhone","created","methods","onThirdLogin","source","faceRoute","$router","resolve","path","$message","success","href","push","catch","window","_CONFIG","open","that","receiveMessage","event","token","warning","includes","strings","split","doThirdLogin","addEventListener","param","ThirdLogin","then","res","loginSuccess","requestFailed","thirdLoginUserBind","uuid","thirdLoginUserCreate","parseInt","Math","random","result","console","log","message","finally","thirdLoginCheckPassword","Object","assign","password","thirdLoginNoPassword","getThirdCaptcha","cmsFailed","interval","setInterval","clearInterval","hide","loading","smsParams","mobile","smsmode","setTimeout","err","thirdHandleOk","bingingParams","captcha","$warning","$notification","description","duration","response","loginBtn"],"mappings":"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","sourcesContent":["/**\r\n *第三方登录\r\n */\r\nimport { mapActions } from 'vuex'\r\nimport { postAction } from '@api/manage'\r\nimport { timeFix } from '@/utils/util'\r\n\r\nexport const JeecgThirdLoginMixin = {\r\n  data() {\r\n    return {\r\n      //第三方登录相关信息\r\n      thirdLoginInfo: '',\r\n      thirdPasswordShow: false,\r\n      thirdLoginPassword: '',\r\n      thirdLoginUser: '',\r\n      thirdConfirmShow: false,\r\n      thirdCreateUserLoding: false,\r\n      thirdLoginState: false,\r\n      //绑定手机号弹窗\r\n      bindingPhoneModal: false,\r\n      thirdPhone: '',\r\n      thirdCaptcha: '',\r\n      //获取验证码按钮30s之内是否可点击\r\n      thirdState: {\r\n        time: 30,\r\n        smsSendBtn: false\r\n      },\r\n      //第三方用户UUID\r\n      thirdUserUuid: '',\r\n      thirdType: '',\r\n      url: {\r\n        bindingThirdPhone: '/sys/thirdLogin/bindingThirdPhone'\r\n      }\r\n    }\r\n  },\r\n  created() {\r\n  },\r\n  methods: {\r\n    ...mapActions(['ThirdLogin']),\r\n    //第三方登录\r\n    onThirdLogin(source) {\r\n      /*if (source === 'face_verify') {\r\n        let faceUrl = ' http://localhost:8080/'\r\n        window.open(faceUrl, `login ${source}`, 'height=500, width=500, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=n o, status=no')\r\n        return\r\n      }*/\r\n      if (source === 'face_verify') {\r\n        // this.$router.push('/faceLogin')\r\n        const faceRoute = this.$router.resolve({ path: '/faceLogin' })\r\n        this.$message.success('url:' + faceRoute.href)\r\n        // window.open(faceRoute.href, `login ${source}`, 'height=500,width=500,top=0,left=0,toolbar=no,menubar=no,scrollbars=no,resizable=no,location=no,status=no')\r\n        // window.open(faceRoute.href, `_blank`, 'height=500,width=500,top=0,left=0,toolbar=no,menubar=no,scrollbars=no,resizable=no,location=no,status=no')\r\n        this.$router.push({ path: '/faceLogin' }).catch(() => {\r\n        })\r\n        return\r\n      }\r\n\r\n      let url = window._CONFIG['domianURL'] + `/sys/thirdLogin/render/${source}`\r\n      window.open(url, `login ${source}`, 'height=500, width=500, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=n o, status=no')\r\n      let that = this\r\n      that.thirdType = source\r\n      that.thirdLoginInfo = ''\r\n      that.thirdLoginState = false\r\n      let receiveMessage = function(event) {\r\n        let token = event.data\r\n        if (typeof token === 'string') {\r\n          //如果是字符串类型 说明是token信息\r\n          if (token === '登录失败') {\r\n            that.$message.warning(token)\r\n          } else if (token.includes('绑定手机号')) {\r\n            that.bindingPhoneModal = true\r\n            let strings = token.split(',')\r\n            that.thirdUserUuid = strings[1]\r\n          } else {\r\n            that.doThirdLogin(token)\r\n          }\r\n        } else if (typeof token === 'object') {\r\n          //对象类型 说明需要提示是否绑定现有账号\r\n          if (token['isObj'] === true) {\r\n            that.thirdConfirmShow = true\r\n            that.thirdLoginInfo = { ...token }\r\n          }\r\n        } else {\r\n          that.$message.warning('不识别的信息传递')\r\n        }\r\n      }\r\n      window.addEventListener('message', receiveMessage, false)\r\n    },\r\n    // 根据token执行登录\r\n    doThirdLogin(token) {\r\n      if (this.thirdLoginState === false) {\r\n        this.thirdLoginState = true\r\n        let param = {}\r\n        param.thirdType = this.thirdType\r\n        param.token = token\r\n        this.ThirdLogin(param).then(res => {\r\n          if (res.success) {\r\n            this.loginSuccess()\r\n          } else {\r\n            this.requestFailed(res)\r\n          }\r\n        })\r\n      }\r\n    },\r\n    // 绑定已有账号 需要输入密码\r\n    thirdLoginUserBind() {\r\n      this.thirdLoginPassword = ''\r\n      this.thirdLoginUser = this.thirdLoginInfo.uuid\r\n      this.thirdConfirmShow = false\r\n      this.thirdPasswordShow = true\r\n    },\r\n    //创建新账号\r\n    thirdLoginUserCreate() {\r\n      this.thirdCreateUserLoding = true\r\n      // 账号名后面添加两位随机数\r\n      this.thirdLoginInfo['suffix'] = parseInt(Math.random() * 98 + 1)\r\n      //this.thirdLoginInfo.operateCode = 123 //测试校验失败\r\n      postAction('/sys/third/user/create', this.thirdLoginInfo).then(res => {\r\n        if (res.success) {\r\n          let token = res.result\r\n          console.log('thirdCreateNewAccount', token)\r\n          this.doThirdLogin(token)\r\n          this.thirdConfirmShow = false\r\n        } else {\r\n          this.$message.warning(res.message)\r\n        }\r\n      }).finally(() => {\r\n        this.thirdCreateUserLoding = false\r\n      })\r\n    },\r\n    // 核实密码\r\n    thirdLoginCheckPassword() {\r\n      //this.thirdLoginInfo.operateCode = 123 //测试校验失败\r\n      let param = Object.assign({}, this.thirdLoginInfo, { password: this.thirdLoginPassword })\r\n      postAction('/sys/third/user/checkPassword', param).then(res => {\r\n        if (res.success) {\r\n          this.thirdLoginNoPassword()\r\n          this.doThirdLogin(res.result)\r\n        } else {\r\n          this.$message.warning(res.message)\r\n        }\r\n      })\r\n    },\r\n    // 没有密码 取消操作\r\n    thirdLoginNoPassword() {\r\n      this.thirdPasswordShow = false\r\n      this.thirdLoginPassword = ''\r\n      this.thirdLoginUser = ''\r\n    },\r\n    //获取第三方验证码\r\n    getThirdCaptcha() {\r\n      let that = this\r\n      if (!this.thirdPhone) {\r\n        that.cmsFailed('请输入手机号')\r\n      } else {\r\n        this.thirdState.smsSendBtn = true\r\n        let interval = window.setInterval(() => {\r\n          if (that.thirdState.time-- <= 0) {\r\n            that.thirdState.time = 30\r\n            that.thirdState.smsSendBtn = false\r\n            window.clearInterval(interval)\r\n          }\r\n        }, 1000)\r\n        const hide = this.$message.loading('验证码发送中..', 0)\r\n        let smsParams = {}\r\n        smsParams.mobile = this.thirdPhone\r\n        smsParams.smsmode = '1'\r\n        postAction('/sys/sms', smsParams).then(res => {\r\n          if (!res.success) {\r\n            setTimeout(hide, 0)\r\n            this.cmsFailed(res.message)\r\n          }\r\n          setTimeout(hide, 500)\r\n        }).catch(err => {\r\n          setTimeout(hide, 1)\r\n          clearInterval(interval)\r\n          that.thirdState.time = 30\r\n          that.thirdState.smsSendBtn = false\r\n          this.requestFailed(err)\r\n        })\r\n      }\r\n    },\r\n    //绑定手机号点击确定按钮\r\n    thirdHandleOk() {\r\n      let bingingParams = {}\r\n      bingingParams.mobile = this.thirdPhone\r\n      bingingParams.captcha = this.thirdCaptcha\r\n      bingingParams.thirdUserUuid = this.thirdUserUuid\r\n      postAction(this.url.bindingThirdPhone, bingingParams).then(res => {\r\n        if (res.success) {\r\n          this.bindingPhoneModal = false\r\n          this.doThirdLogin(res.result)\r\n        } else {\r\n          this.$message.$warning(res.message)\r\n        }\r\n      })\r\n    },\r\n    loginSuccess() {\r\n      // update-begin- author:sunjianlei --- date:20190812 --- for: 登录成功后不解除禁用按钮，防止多次点击\r\n      // this.loginBtn = false\r\n      // update-end- author:sunjianlei --- date:20190812 --- for: 登录成功后不解除禁用按钮，防止多次点击\r\n      this.$router.push({ path: '/dashboard/analysis' }).catch(() => {\r\n        console.log('登录跳转首页出错,这个错误从哪里来的')\r\n      })\r\n      this.$notification.success({\r\n        message: '欢迎',\r\n        description: `${timeFix()}，欢迎回来`\r\n      })\r\n    },\r\n    cmsFailed(err) {\r\n      this.$notification['error']({\r\n        message: '登录失败',\r\n        description: err,\r\n        duration: 4\r\n      })\r\n    },\r\n    requestFailed(err) {\r\n      this.$notification['error']({\r\n        message: '登录失败',\r\n        description: ((err.response || {}).data || {}).message || err.message || '请求出现错误，请稍后再试',\r\n        duration: 4\r\n      })\r\n      this.loginBtn = false\r\n    }\r\n  }\r\n\r\n}"]}]}