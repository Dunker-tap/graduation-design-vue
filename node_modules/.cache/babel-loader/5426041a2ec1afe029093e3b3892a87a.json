{"remainingRequest":"E:\\IDEA\\project\\ant-design-vue-jeecg\\node_modules\\babel-loader\\lib\\index.js!E:\\IDEA\\project\\ant-design-vue-jeecg\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js??ref--13-0!E:\\IDEA\\project\\ant-design-vue-jeecg\\src\\store\\modules\\user.js","dependencies":[{"path":"E:\\IDEA\\project\\ant-design-vue-jeecg\\src\\store\\modules\\user.js","mtime":1715593474899},{"path":"E:\\IDEA\\project\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1621061384845},{"path":"E:\\IDEA\\project\\ant-design-vue-jeecg\\node_modules\\babel-loader\\lib\\index.js","mtime":1621061377995},{"path":"E:\\IDEA\\project\\ant-design-vue-jeecg\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js","mtime":1617935819779}],"contextDependencies":[],"result":["import Vue from 'vue';\nimport { faceLogin as _faceLogin, login, logout, phoneLogin, thirdLogin } from '@/api/login';\nimport { ACCESS_TOKEN, CACHE_INCLUDED_ROUTES, SYS_BUTTON_AUTH, TENANT_ID, UI_CACHE_DB_DICT_DATA, USER_AUTH, USER_INFO, USER_NAME } from '@/store/mutation-types';\nimport { welcome } from '@/utils/util';\nimport { queryPermissionsByUser } from '@/api/api';\nimport { getAction } from '@/api/manage';\nvar user = {\n  state: {\n    token: '',\n    username: '',\n    realname: '',\n    tenantid: '',\n    welcome: '',\n    avatar: '',\n    permissionList: [],\n    info: {}\n  },\n  mutations: {\n    SET_TOKEN: function SET_TOKEN(state, token) {\n      state.token = token;\n    },\n    SET_NAME: function SET_NAME(state, _ref) {\n      var username = _ref.username,\n          realname = _ref.realname,\n          welcome = _ref.welcome;\n      state.username = username;\n      state.realname = realname;\n      state.welcome = welcome;\n    },\n    SET_AVATAR: function SET_AVATAR(state, avatar) {\n      state.avatar = avatar;\n    },\n    SET_PERMISSIONLIST: function SET_PERMISSIONLIST(state, permissionList) {\n      state.permissionList = permissionList;\n    },\n    SET_INFO: function SET_INFO(state, info) {\n      state.info = info;\n    },\n    SET_TENANT: function SET_TENANT(state, id) {\n      state.tenantid = id;\n    }\n  },\n  //没有进行暴露，这个地方我也不懂为啥，Login.vue能调用，我们的face.vue就不能调用，OK了\n  actions: {\n    // CAS验证登录\n    ValidateLogin: function ValidateLogin(_ref2, userInfo) {\n      var commit = _ref2.commit;\n      return new Promise(function (resolve, reject) {\n        getAction('/sys/cas/client/validateLogin', userInfo).then(function (response) {\n          console.log('----cas 登录--------', response);\n\n          if (response.success) {\n            var result = response.result;\n            var _userInfo = result.userInfo;\n            Vue.ls.set(ACCESS_TOKEN, result.token, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_NAME, _userInfo.username, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_INFO, _userInfo, 7 * 24 * 60 * 60 * 1000);\n            commit('SET_TOKEN', result.token);\n            commit('SET_INFO', _userInfo);\n            commit('SET_NAME', {\n              username: _userInfo.username,\n              realname: _userInfo.realname,\n              welcome: welcome()\n            });\n            commit('SET_AVATAR', _userInfo.avatar);\n            resolve(response);\n          } else {\n            resolve(response);\n          }\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 登录\n    Login: function Login(_ref3, userInfo) {\n      var commit = _ref3.commit;\n      return new Promise(function (resolve, reject) {\n        login(userInfo).then(function (response) {\n          if (response.code == '200') {\n            var result = response.result;\n            var _userInfo2 = result.userInfo;\n            Vue.ls.set(ACCESS_TOKEN, result.token, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_NAME, _userInfo2.username, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_INFO, _userInfo2, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(UI_CACHE_DB_DICT_DATA, result.sysAllDictItems, 7 * 24 * 60 * 60 * 1000);\n            commit('SET_TOKEN', result.token);\n            commit('SET_INFO', _userInfo2);\n            commit('SET_NAME', {\n              username: _userInfo2.username,\n              realname: _userInfo2.realname,\n              welcome: welcome()\n            });\n            commit('SET_AVATAR', _userInfo2.avatar);\n            resolve(response);\n          } else {\n            reject(response);\n          }\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    //人脸登录,commit是内构函数，imagesBases是传递的参数\n    faceLogin: function faceLogin(_ref4, imageBase) {\n      var commit = _ref4.commit;\n      return new Promise(function (resolve, reject) {\n        _faceLogin(imageBase).then(function (response) {\n          //表示请求成功\n          if (response.code == '200') {\n            var result = response.result;\n            console.log(result.toJSON());\n            var userInfo = result.userInfo;\n            Vue.ls.set(ACCESS_TOKEN, result.token, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_NAME, userInfo.username, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_INFO, userInfo, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(UI_CACHE_DB_DICT_DATA, result.sysAllDictItems, 7 * 24 * 60 * 60 * 1000);\n            commit('SET_TOKEN', result.token);\n            commit('SET_INFO', userInfo);\n            commit('SET_NAME', {\n              username: userInfo.username,\n              realname: userInfo.realname,\n              welcome: welcome()\n            });\n            commit('SET_AVATAR', userInfo.avatar);\n            resolve(response);\n          } else {\n            reject(response);\n          }\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    //手机号登录\n    PhoneLogin: function PhoneLogin(_ref5, userInfo) {\n      var commit = _ref5.commit;\n      return new Promise(function (resolve, reject) {\n        phoneLogin(userInfo).then(function (response) {\n          if (response.code == '200') {\n            var result = response.result;\n            var _userInfo3 = result.userInfo;\n            Vue.ls.set(ACCESS_TOKEN, result.token, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_NAME, _userInfo3.username, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_INFO, _userInfo3, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(UI_CACHE_DB_DICT_DATA, result.sysAllDictItems, 7 * 24 * 60 * 60 * 1000);\n            commit('SET_TOKEN', result.token);\n            commit('SET_INFO', _userInfo3);\n            commit('SET_NAME', {\n              username: _userInfo3.username,\n              realname: _userInfo3.realname,\n              welcome: welcome()\n            });\n            commit('SET_AVATAR', _userInfo3.avatar);\n            resolve(response);\n          } else {\n            reject(response);\n          }\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 获取用户信息\n    GetPermissionList: function GetPermissionList(_ref6) {\n      var commit = _ref6.commit;\n      return new Promise(function (resolve, reject) {\n        queryPermissionsByUser().then(function (response) {\n          var menuData = response.result.menu;\n          var authData = response.result.auth;\n          var allAuthData = response.result.allAuth; //Vue.ls.set(USER_AUTH,authData);\n\n          sessionStorage.setItem(USER_AUTH, JSON.stringify(authData));\n          sessionStorage.setItem(SYS_BUTTON_AUTH, JSON.stringify(allAuthData));\n\n          if (menuData && menuData.length > 0) {\n            //update--begin--autor:qinfeng-----date:20200109------for：JEECG-63 一级菜单的子菜单全部是隐藏路由，则一级菜单不显示------\n            menuData.forEach(function (item, index) {\n              if (item['children']) {\n                var hasChildrenMenu = item['children'].filter(function (i) {\n                  return !i.hidden || i.hidden == false;\n                });\n\n                if (hasChildrenMenu == null || hasChildrenMenu.length == 0) {\n                  item['hidden'] = true;\n                }\n              }\n            }); //console.log(\" menu show json \", menuData)\n            //update--end--autor:qinfeng-----date:20200109------for：JEECG-63 一级菜单的子菜单全部是隐藏路由，则一级菜单不显示------\n\n            commit('SET_PERMISSIONLIST', menuData);\n          } else {\n            reject('getPermissionList: permissions must be a non-null array !');\n          }\n\n          resolve(response);\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 登出\n    Logout: function Logout(_ref7) {\n      var commit = _ref7.commit,\n          state = _ref7.state;\n      return new Promise(function (resolve) {\n        var logoutToken = state.token;\n        commit('SET_TOKEN', '');\n        commit('SET_PERMISSIONLIST', []);\n        Vue.ls.remove(ACCESS_TOKEN);\n        Vue.ls.remove(UI_CACHE_DB_DICT_DATA);\n        Vue.ls.remove(CACHE_INCLUDED_ROUTES); //console.log('logoutToken: '+ logoutToken)\n\n        logout(logoutToken).then(function () {\n          if (process.env.VUE_APP_SSO == 'true') {\n            var sevice = 'http://' + window.location.host + '/';\n            var serviceUrl = encodeURIComponent(sevice);\n            window.location.href = process.env.VUE_APP_CAS_BASE_URL + '/logout?service=' + serviceUrl;\n          }\n\n          resolve();\n        }).catch(function () {\n          resolve();\n        });\n      });\n    },\n    // 第三方登录\n    ThirdLogin: function ThirdLogin(_ref8, param) {\n      var commit = _ref8.commit;\n      return new Promise(function (resolve, reject) {\n        thirdLogin(param.token, param.thirdType).then(function (response) {\n          if (response.code == '200') {\n            var result = response.result;\n            var userInfo = result.userInfo;\n            Vue.ls.set(ACCESS_TOKEN, result.token, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_NAME, userInfo.username, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_INFO, userInfo, 7 * 24 * 60 * 60 * 1000);\n            commit('SET_TOKEN', result.token);\n            commit('SET_INFO', userInfo);\n            commit('SET_NAME', {\n              username: userInfo.username,\n              realname: userInfo.realname,\n              welcome: welcome()\n            });\n            commit('SET_AVATAR', userInfo.avatar);\n            resolve(response);\n          } else {\n            reject(response);\n          }\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    saveTenant: function saveTenant(_ref9, id) {\n      var commit = _ref9.commit;\n      Vue.ls.set(TENANT_ID, id, 7 * 24 * 60 * 60 * 1000);\n      commit('SET_TENANT', id);\n    }\n  }\n};\nexport default user;",{"version":3,"sources":["E:/IDEA/project/ant-design-vue-jeecg/src/store/modules/user.js"],"names":["Vue","faceLogin","login","logout","phoneLogin","thirdLogin","ACCESS_TOKEN","CACHE_INCLUDED_ROUTES","SYS_BUTTON_AUTH","TENANT_ID","UI_CACHE_DB_DICT_DATA","USER_AUTH","USER_INFO","USER_NAME","welcome","queryPermissionsByUser","getAction","user","state","token","username","realname","tenantid","avatar","permissionList","info","mutations","SET_TOKEN","SET_NAME","SET_AVATAR","SET_PERMISSIONLIST","SET_INFO","SET_TENANT","id","actions","ValidateLogin","userInfo","commit","Promise","resolve","reject","then","response","console","log","success","result","ls","set","catch","error","Login","code","sysAllDictItems","imageBase","toJSON","PhoneLogin","GetPermissionList","menuData","menu","authData","auth","allAuthData","allAuth","sessionStorage","setItem","JSON","stringify","length","forEach","item","index","hasChildrenMenu","filter","i","hidden","Logout","logoutToken","remove","process","env","VUE_APP_SSO","sevice","window","location","host","serviceUrl","encodeURIComponent","href","VUE_APP_CAS_BASE_URL","ThirdLogin","param","thirdType","saveTenant"],"mappings":"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","sourcesContent":["import Vue from 'vue'\r\nimport { faceLogin, login, logout, phoneLogin, thirdLogin } from '@/api/login'\r\nimport {\r\n  ACCESS_TOKEN,\r\n  CACHE_INCLUDED_ROUTES,\r\n  SYS_BUTTON_AUTH,\r\n  TENANT_ID,\r\n  UI_CACHE_DB_DICT_DATA,\r\n  USER_AUTH,\r\n  USER_INFO,\r\n  USER_NAME\r\n} from '@/store/mutation-types'\r\nimport { welcome } from '@/utils/util'\r\nimport { queryPermissionsByUser } from '@/api/api'\r\nimport { getAction } from '@/api/manage'\r\n\r\nconst user = {\r\n  state: {\r\n    token: '',\r\n    username: '',\r\n    realname: '',\r\n    tenantid: '',\r\n    welcome: '',\r\n    avatar: '',\r\n    permissionList: [],\r\n    info: {}\r\n  },\r\n\r\n  mutations: {\r\n    SET_TOKEN: (state, token) => {\r\n      state.token = token\r\n    },\r\n    SET_NAME: (state, { username, realname, welcome }) => {\r\n      state.username = username\r\n      state.realname = realname\r\n      state.welcome = welcome\r\n    },\r\n    SET_AVATAR: (state, avatar) => {\r\n      state.avatar = avatar\r\n    },\r\n    SET_PERMISSIONLIST: (state, permissionList) => {\r\n      state.permissionList = permissionList\r\n    },\r\n    SET_INFO: (state, info) => {\r\n      state.info = info\r\n    },\r\n    SET_TENANT: (state, id) => {\r\n      state.tenantid = id\r\n    }\r\n  },\r\n\r\n  //没有进行暴露，这个地方我也不懂为啥，Login.vue能调用，我们的face.vue就不能调用，OK了\r\n  actions: {\r\n    // CAS验证登录\r\n    ValidateLogin({ commit }, userInfo) {\r\n      return new Promise((resolve, reject) => {\r\n        getAction('/sys/cas/client/validateLogin', userInfo).then(response => {\r\n          console.log('----cas 登录--------', response)\r\n          if (response.success) {\r\n            const result = response.result\r\n            const userInfo = result.userInfo\r\n            Vue.ls.set(ACCESS_TOKEN, result.token, 7 * 24 * 60 * 60 * 1000)\r\n            Vue.ls.set(USER_NAME, userInfo.username, 7 * 24 * 60 * 60 * 1000)\r\n            Vue.ls.set(USER_INFO, userInfo, 7 * 24 * 60 * 60 * 1000)\r\n            commit('SET_TOKEN', result.token)\r\n            commit('SET_INFO', userInfo)\r\n            commit('SET_NAME', { username: userInfo.username, realname: userInfo.realname, welcome: welcome() })\r\n            commit('SET_AVATAR', userInfo.avatar)\r\n            resolve(response)\r\n          } else {\r\n            resolve(response)\r\n          }\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n    // 登录\r\n    Login({ commit }, userInfo) {\r\n      return new Promise((resolve, reject) => {\r\n        login(userInfo).then(response => {\r\n          if (response.code == '200') {\r\n            const result = response.result\r\n            const userInfo = result.userInfo\r\n            Vue.ls.set(ACCESS_TOKEN, result.token, 7 * 24 * 60 * 60 * 1000)\r\n            Vue.ls.set(USER_NAME, userInfo.username, 7 * 24 * 60 * 60 * 1000)\r\n            Vue.ls.set(USER_INFO, userInfo, 7 * 24 * 60 * 60 * 1000)\r\n            Vue.ls.set(UI_CACHE_DB_DICT_DATA, result.sysAllDictItems, 7 * 24 * 60 * 60 * 1000)\r\n            commit('SET_TOKEN', result.token)\r\n            commit('SET_INFO', userInfo)\r\n            commit('SET_NAME', { username: userInfo.username, realname: userInfo.realname, welcome: welcome() })\r\n            commit('SET_AVATAR', userInfo.avatar)\r\n            resolve(response)\r\n          } else {\r\n            reject(response)\r\n          }\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n    //人脸登录,commit是内构函数，imagesBases是传递的参数\r\n    faceLogin({ commit }, imageBase) {\r\n      return new Promise((resolve, reject) => {\r\n        faceLogin(imageBase).then(response => {\r\n          //表示请求成功\r\n          if (response.code == '200') {\r\n            const result = response.result\r\n            console.log(result.toJSON())\r\n            const userInfo = result.userInfo\r\n            Vue.ls.set(ACCESS_TOKEN, result.token, 7 * 24 * 60 * 60 * 1000)\r\n            Vue.ls.set(USER_NAME, userInfo.username, 7 * 24 * 60 * 60 * 1000)\r\n            Vue.ls.set(USER_INFO, userInfo, 7 * 24 * 60 * 60 * 1000)\r\n            Vue.ls.set(UI_CACHE_DB_DICT_DATA, result.sysAllDictItems, 7 * 24 * 60 * 60 * 1000)\r\n            commit('SET_TOKEN', result.token)\r\n            commit('SET_INFO', userInfo)\r\n            commit('SET_NAME', { username: userInfo.username, realname: userInfo.realname, welcome: welcome() })\r\n            commit('SET_AVATAR', userInfo.avatar)\r\n            resolve(response)\r\n          } else {\r\n            reject(response)\r\n          }\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n    //手机号登录\r\n    PhoneLogin({ commit }, userInfo) {\r\n      return new Promise((resolve, reject) => {\r\n        phoneLogin(userInfo).then(response => {\r\n          if (response.code == '200') {\r\n            const result = response.result\r\n            const userInfo = result.userInfo\r\n            Vue.ls.set(ACCESS_TOKEN, result.token, 7 * 24 * 60 * 60 * 1000)\r\n            Vue.ls.set(USER_NAME, userInfo.username, 7 * 24 * 60 * 60 * 1000)\r\n            Vue.ls.set(USER_INFO, userInfo, 7 * 24 * 60 * 60 * 1000)\r\n            Vue.ls.set(UI_CACHE_DB_DICT_DATA, result.sysAllDictItems, 7 * 24 * 60 * 60 * 1000)\r\n            commit('SET_TOKEN', result.token)\r\n            commit('SET_INFO', userInfo)\r\n            commit('SET_NAME', { username: userInfo.username, realname: userInfo.realname, welcome: welcome() })\r\n            commit('SET_AVATAR', userInfo.avatar)\r\n            resolve(response)\r\n          } else {\r\n            reject(response)\r\n          }\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n    // 获取用户信息\r\n    GetPermissionList({ commit }) {\r\n      return new Promise((resolve, reject) => {\r\n        queryPermissionsByUser().then(response => {\r\n          const menuData = response.result.menu\r\n          const authData = response.result.auth\r\n          const allAuthData = response.result.allAuth\r\n          //Vue.ls.set(USER_AUTH,authData);\r\n          sessionStorage.setItem(USER_AUTH, JSON.stringify(authData))\r\n          sessionStorage.setItem(SYS_BUTTON_AUTH, JSON.stringify(allAuthData))\r\n          if (menuData && menuData.length > 0) {\r\n            //update--begin--autor:qinfeng-----date:20200109------for：JEECG-63 一级菜单的子菜单全部是隐藏路由，则一级菜单不显示------\r\n            menuData.forEach((item, index) => {\r\n              if (item['children']) {\r\n                let hasChildrenMenu = item['children'].filter((i) => {\r\n                  return !i.hidden || i.hidden == false\r\n                })\r\n                if (hasChildrenMenu == null || hasChildrenMenu.length == 0) {\r\n                  item['hidden'] = true\r\n                }\r\n              }\r\n            })\r\n            //console.log(\" menu show json \", menuData)\r\n            //update--end--autor:qinfeng-----date:20200109------for：JEECG-63 一级菜单的子菜单全部是隐藏路由，则一级菜单不显示------\r\n            commit('SET_PERMISSIONLIST', menuData)\r\n          } else {\r\n            reject('getPermissionList: permissions must be a non-null array !')\r\n          }\r\n          resolve(response)\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n\r\n    // 登出\r\n    Logout({ commit, state }) {\r\n      return new Promise((resolve) => {\r\n        let logoutToken = state.token\r\n        commit('SET_TOKEN', '')\r\n        commit('SET_PERMISSIONLIST', [])\r\n        Vue.ls.remove(ACCESS_TOKEN)\r\n        Vue.ls.remove(UI_CACHE_DB_DICT_DATA)\r\n        Vue.ls.remove(CACHE_INCLUDED_ROUTES)\r\n        //console.log('logoutToken: '+ logoutToken)\r\n        logout(logoutToken).then(() => {\r\n          if (process.env.VUE_APP_SSO == 'true') {\r\n            let sevice = 'http://' + window.location.host + '/'\r\n            let serviceUrl = encodeURIComponent(sevice)\r\n            window.location.href = process.env.VUE_APP_CAS_BASE_URL + '/logout?service=' + serviceUrl\r\n          }\r\n          resolve()\r\n        }).catch(() => {\r\n          resolve()\r\n        })\r\n      })\r\n    },\r\n    // 第三方登录\r\n    ThirdLogin({ commit }, param) {\r\n      return new Promise((resolve, reject) => {\r\n        thirdLogin(param.token, param.thirdType).then(response => {\r\n          if (response.code == '200') {\r\n            const result = response.result\r\n            const userInfo = result.userInfo\r\n            Vue.ls.set(ACCESS_TOKEN, result.token, 7 * 24 * 60 * 60 * 1000)\r\n            Vue.ls.set(USER_NAME, userInfo.username, 7 * 24 * 60 * 60 * 1000)\r\n            Vue.ls.set(USER_INFO, userInfo, 7 * 24 * 60 * 60 * 1000)\r\n            commit('SET_TOKEN', result.token)\r\n            commit('SET_INFO', userInfo)\r\n            commit('SET_NAME', { username: userInfo.username, realname: userInfo.realname, welcome: welcome() })\r\n            commit('SET_AVATAR', userInfo.avatar)\r\n            resolve(response)\r\n          } else {\r\n            reject(response)\r\n          }\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n    saveTenant({ commit }, id) {\r\n      Vue.ls.set(TENANT_ID, id, 7 * 24 * 60 * 60 * 1000)\r\n      commit('SET_TENANT', id)\r\n    }\r\n\r\n  }\r\n}\r\n\r\nexport default user"]}]}